<html>
    <head>
        <script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-3.1.0.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" />

        <style>

            body {
                padding-top: 50px;
            }

            .screen-name {
                color: green;
            }

            .screen-name.failed {
                color: red;
            }
            
            .panel-default:not(.failed) .change-diff,
            .panel-default:not(.failed) .manage-buttons  {
                display: none;
            }

        </style>
    </head>
    <body>
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="container">
                <div class="navbar-header">                
                    <a class="navbar-brand" href="#">Screenshot Reporter</a>
                </div>
            </div>
        </nav>

        <div class="container">

            <h1>{{fixture}}</h1>
            
            {{#items}}
            <div class="row panel panel-default {{failed}}">
                <div class="comparing-item panel-body">
                    <a href="#item-{{index}}" data-toggle="collapse">
                        <h3 class="screen-name {{failed}}" >{{name}}</h3>
                    </a>
                    <div id="item-{{index}}" class="collapse">

                        <div class="navbar navbar-default">
                            
                            <div class="container-fluid">
                                <ul class="nav navbar-nav">
                                    <li class="change-current active"><a>Current</a></li>
                                    <li class="change-etalon"><a>Etalon</a></li>
                                    <li class="change-diff"><a>Diff</a></li>
                                </ul>

                                <div class="manage-buttons nav navbar-form navbar-right">
                                    <div class="btn btn-danger button etalon" data-current="{{current}}" data-etalon="{{etalon}}">make etalon</div>
                                    <div class="btn btn-danger button mask"  data-current="{{current}}" data-etalon="{{etalon}}">create mask</div>
                                </div>
                            </div>
                        
                        </div>

                        <div class="row">
                            <div class="col-md-12 text-center">
                                <img class="image img-thumbnail" alt="{{current}}" src="{{current}}" data-current="{{current}}" data-etalon="{{etalon}}" data-diff="{{diff}}" />                   
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {{/items}}
        </div>

        <script>
            $(function(){

                function setImage(trigger, state) {
                    var image = $(trigger).parents(".comparing-item").find(".image");                    
                    image.attr("src", image.data(state));
                }

                function setCurrent(element){
                    $(element).siblings().removeClass("active");
                    $(element).addClass("active");
                }

                $.each([ "current", "etalon", "diff" ], function(_, tabName){
                     $(".change-" + tabName).click(function(){
                        setCurrent(this);
                        setImage(this, tabName);
                    });
                });

                $.each([ "etalon", "mask" ], function(_, buttonName){
                     $(".button." + buttonName).click(function(){
                        var action = buttonName;
                        var etalon = $(this).data("etalon");
                        var current = $(this).data("current");
                        $.post({
                            url: "http://localhost:9000/" + action + "/",
                            data: {
                                etalonPath: "../" + etalon,
                                artefactPath: "../" + current
                            }
                        });
                    });
                });

            });
        </script>
    </body>
</html>
